(function(e,t){if(typeof define==="function"&&define.amd){define("gridster-collision",["jquery","gridster-coords"],t)}else{e.GridsterCollision=t(e.$||e.jQuery,e.GridsterCoords)}})(this,function(e,t){function r(t,r,i){this.options=e.extend(n,i);this.$element=t;this.last_colliders=[];this.last_colliders_coords=[];this.set_colliders(r);this.init()}var n={colliders_context:document.body,overlapping_region:"C"};r.defaults=n;var i=r.prototype;i.init=function(){this.find_collisions()};i.overlaps=function(e,t){var n=false;var r=false;if(t.x1>=e.x1&&t.x1<=e.x2||t.x2>=e.x1&&t.x2<=e.x2||e.x1>=t.x1&&e.x2<=t.x2){n=true}if(t.y1>=e.y1&&t.y1<=e.y2||t.y2>=e.y1&&t.y2<=e.y2||e.y1>=t.y1&&e.y2<=t.y2){r=true}return n&&r};i.detect_overlapping_region=function(e,t){var n="";var r="";if(e.y1>t.cy&&e.y1<t.y2){n="N"}if(e.y2>t.y1&&e.y2<t.cy){n="S"}if(e.x1>t.cx&&e.x1<t.x2){r="W"}if(e.x2>t.x1&&e.x2<t.cx){r="E"}return n+r||"C"};i.calculate_overlapped_area_coords=function(t,n){var r=Math.max(t.x1,n.x1);var i=Math.max(t.y1,n.y1);var s=Math.min(t.x2,n.x2);var o=Math.min(t.y2,n.y2);return e({left:r,top:i,width:s-r,height:o-i}).coords().get()};i.calculate_overlapped_area=function(e){return e.width*e.height};i.manage_colliders_start_stop=function(t,n,r){var i=this.last_colliders_coords;for(var s=0,o=i.length;s<o;s++){if(e.inArray(i[s],t)===-1){n.call(this,i[s])}}for(var u=0,a=t.length;u<a;u++){if(e.inArray(t[u],i)===-1){r.call(this,t[u])}}};i.find_collisions=function(t){var n=this;var r=this.options.overlapping_region;var i=[];var s=[];var o=this.colliders||this.$colliders;var u=o.length;var a=n.$element.coords().update(t||false).get();while(u--){var f=n.$colliders?e(o[u]):o[u];var l=f.isCoords?f:f.coords();var c=l.get();var h=n.overlaps(a,c);if(!h){continue}var p=n.detect_overlapping_region(a,c);if(p===r||r==="all"){var d=n.calculate_overlapped_area_coords(a,c);var v=n.calculate_overlapped_area(d);var m={area:v,area_coords:d,region:p,coords:c,player_coords:a,el:f};if(n.options.on_overlap){n.options.on_overlap.call(this,m)}i.push(l);s.push(m)}}if(n.options.on_overlap_stop||n.options.on_overlap_start){this.manage_colliders_start_stop(i,n.options.on_overlap_start,n.options.on_overlap_stop)}this.last_colliders_coords=i;return s};i.get_closest_colliders=function(e){var t=this.find_collisions(e);t.sort(function(e,t){if(e.region==="C"&&t.region==="C"){if(e.coords.y1<t.coords.y1||e.coords.x1<t.coords.x1){return-1}else{return 1}}if(e.area<t.area){return 1}return 1});return t};i.set_colliders=function(t){if(typeof t==="string"||t instanceof e){this.$colliders=e(t,this.options.colliders_context).not(this.$element)}else{this.colliders=e(t)}};e.fn.collision=function(e,t){return new r(this,e,t)};return r})